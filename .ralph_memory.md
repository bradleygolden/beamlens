# Ralph Memory

## Active Work
- **Issue #12: GC Pattern Analysis and Hibernation Recommendations** (2026-01-22)
  - Status: OPEN on fork, ready to implement
  - Enhance GC skill with pattern analysis for performance bottlenecks
  - State limits: 0/1 open PRs to upstream, 1/2 open issues on fork
  - Next: Create ralph/issue-12 branch and implement

## Recent Completions
- PR #29: Memory Allocator Monitoring - **MERGED** (2026-01-22T02:19:53Z)
  - Issue #11 implementation on ralph/issue-11 branch
  - New Allocator skill with 4 callbacks: allocator_summary, allocator_by_type, allocator_fragmentation, allocator_problematic
  - Monitors 10 VM allocators for carrier utilization and fragmentation
  - Metrics: carriers, blocks, block_size_mb, carrier_size_mb, usage_ratio
  - All 601 tests passing (14 new tests in allocator_test.exs), Credo clean, Dialyzer clean
  - Zero production impact: All operations read-only using erlang:system_info
- PR #28: Inet Port Monitoring - **MERGED** (2026-01-21T23:19:02Z)
  - Issue #9 implementation on ralph/inet-port-monitoring branch
  - 3 new callbacks: ports_list_inet, ports_top_by_buffer, ports_inet_stats
  - Socket state tracking with local/remote addresses for TCP/UDP/SCTP
  - Buffer size monitoring for send/recv queues
  - All 587 tests passing, Credo clean, Dialyzer clean
- PR #27: Binary Memory Leak Detection - **MERGED** (2026-01-21T22:38:51Z)
  - Issue #7 implementation
  - Rate limiting, beam_binary_info, snapshot binary_memory_mb
  - All 578 tests passing, Credo clean, Dialyzer clean

## Queue
- Issue #12: GC Pattern Analysis and Hibernation Recommendations (medium impact) - **ACTIVE**
  - Current state: 0/1 open PRs, 1/2 open issues
  - Next: Implement GC pattern analysis callbacks

## Patterns
- Use :erlang.memory(:binary) for leak detection
- Process.info/2 for queue lengths
- :erlang.system_flag(:scheduler_wall_time, true) for scheduler utilization
- :erlang.system_monitor/2 for long_gc/long_schedule events
- Enum.max with empty list guard: `if list == [], do: 0, else: Enum.max(list)`
- All operations must be read-only
- Follow AGENTS.md conventions strictly
- Handle OTP version compatibility with rescue ArgumentError for unsupported features
- Always rebase feature branches onto upstream main before pushing
- Test GenServer state via public APIs, not internal state inspection
- Use GenServer with init/1 initial sample for immediate availability
- Use `send(pid, :message)` for synchronous test control of GenServers
- **Use pattern matching and guards to avoid deeply nested code** - Credo max depth is 2
- **Extract complex calculations into helper functions with guard clauses** for readability
- **Edge case testing**: Create tests that manipulate data to trigger edge conditions (e.g., identical timestamps)

## Learnings
- Test setup: Use `setup_all` with `start_supervised!` for singleton processes like Puck.Test
  - Puck.Test lacks child_spec/1, must provide: `%{id: Puck.Test, start: {Puck.Test, :start_link, []}}`
  - setup_all preferred over setup for singletons started once per test suite
- Review feedback: Address all review comments promptly
  - You're a capable LLM - you only need guidance, not detailed instructions
  - Reviewers' questions are hints, not mandates - use judgment
- **IMPORTANT**: Always double-check PR review comments regardless of memory
  - Memory may say "addressed" but comments may still show as unresolved on GitHub
  - Verify by checking: gh api repos/owner/repo/pulls/N/comments
  - Look for null state or lack of "RESOLVED" status
  - Cross-reference commit timestamps with comment timestamps to verify response
  - **Outdated comments**: Review comments from earlier commits remain visible even after fix
  - Check PR head SHA vs comment commit_id to verify if comment applies to current state
- Non-critical comments: Remove explanatory comments that don't add value
  - Code should be self-documenting through clear naming
- **LLM Inference Pattern (PR #24 feedback)**:
  - Avoid overly prescriptive documentation - LLMs can infer from guidance
  - Hard-coding deterministic steps is a code smell
  - Let LLMs synthesize insights rather than following step-by-step recipes
  - Document intent and patterns, not every field or implementation detail
  - Only use determinism where inference is 100% not needed
- **OTP version compatibility handling**:
  - Some system_monitor options (busy_port, busy_dist_port) not available in all OTP versions
  - Wrap unsupported calls in rescue ArgumentError to handle gracefully
  - Use @dialyzer {:nowarn_function, ...} to suppress dialyzer warnings for version-specific code
  - Pattern: rescue for OTP version differences, catch for other errors
- **Dialyzer and version-specific features**:
  - Dialyzer checks typespecs against Erlang/OTP built-in types
  - New OTP features may not exist in typespecs of older versions
  - Use @dialyzer {:nowarn_function, ...} directive when intentionally using newer features
  - Rescue clause provides runtime safety, dialyzer directive provides compile-time suppression
- **PR #28 Fourteenth Research (2026-01-22)**: Comprehensive review while blocked on state limits
  - Verified PR head SHA (d0c414e) does not contain .ralph_memory.md
  - Identified review comment as outdated (from commit c51ef215, before cleanup)
  - GitHub API retains old review comments even after commits are replaced
  - Solution: Compare PR head SHA with comment commit_id to determine if comment applies
  - All 587 tests passing, Credo clean (988 mods/funs), Dialyzer clean
  - Pattern consistency verified against ETS and GC skills
  - No improvements found - PR equals quality of PRs #24/#25/#27
  - 100% confidence in implementation quality
  - Ready for review and merge
